<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Follow Up</title>
    <script src="https://cdn.tiny.cloud/1/8wtxfoo5se51jl9zmlz4obivgwepjmxh88vtkopcqk3iuntr/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='follow_up.css') }}">
</head>
<body>
    <h2>Follow Up</h2>
    <form method="POST" id="follow_up_form">
        <div class="btn-container">
            <button type="submit" class="btn-confirm">Confirmar</button>
            <button type="button" class="btn-cancel" onclick="window.history.back()">Cancelar</button>
        </div>
        {% for contrato in contrato_data %}
            <div class="form-section">
                <div class="form-grid">
                    <div>
                        <label for="client_id">CÓD.</label>
                        <input type="text" id="client_id" value="{{ contrato['client_id'] }}" readonly>
                    </div>
                    <div class="long-input">
                        <label for="company">NOME DA EMPRESA:</label>
                        <input type="text" id="company" name="company" value="{{ contrato['company'] }}" readonly>
                    </div>
                    <div class="long-input">
                        <label for="cpf_cnpj">CPF/CNPJ:</label>
                        <input type="text" id="cpf_cnpj" name="cpf_cnpj" value="{{ contrato['cpf_cnpj'] }}" readonly>
                    </div>
                    <div>
                        <label for="contract_id">CONTRATO:</label>
                        <input type="text" id="contract_id" name="contract_id" value="{{ contrato['contrato'].contract_id }}" readonly>
                    </div>
                </div>
            </div>
        {% endfor %}

        <div class="form-section">
            <div class="table-address">
                <table>
                    <tbody id="address_table_body">
                        {% for dados in contrato_data %}
                            <tr>
                                <td class="bold1">End. Sede:</td>
                                <td class="column2">{{ dados['company_address'] }}</td>
                                <td class="column3">{{ '' }}</td>
                                <td class="column4">{{ dados['municipio'] }}</td>
                                <td class="column5">{{ dados['uf'] }}</td>
                                <td class="column6">{{ '' }}</td>
                                <td class="column7">{{ '' }}</td>
                            </tr>
                            <tr>
                                <td class="bold1">End. Obra:</td>
                                <td>{{ dados['delivery_address'] }}</td>
                                <td>{{ '' }}</td>
                                <td>{{ dados['delivery_municipio'] }}</td>
                                <td>{{ delivery_uf }}</td>
                                <td class="bold2">PROPOSTA</td>
                                <td class="bold2">DATA CONTRATO</td>
                            </tr>
                            <tr>
                                <td class="bold1">Contato:</td>
                                <td>{{ dados['contact_name'] }}</td>
                                <td>{{ dados['phone'] }}</td>
                                <td>{{ dados['email'] }}</td>
                                <td>{{ '' }}</td>
                                <td>{{ dados['contrato'].proposal_id }}</td>
                                <td>{{ dados['contrato'].date_issue }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="form-section">
            <div class="table-others-data">
                <table>
                    <tbody id="others_data_table_body">
                        {% for dados in contrato_data %}
                            <tr>
                                <td class="col01">PEDIDO</td>
                                <td class="col02">CONDIÇÃO DE PAGAMENTO</td>
                                <td class="col03">DATA INICIO</td>
                                <td class="col04">DATA FINAL</td>
                                <td class="col05">DIAS</td>
                                <td class="col06">FRANQUIA</td>
                                <td class="col07">VL HR EXC:</td>
                                <td class="col08">{{ dados['produtos'].extra_hours }}</td>
                            </tr>
                            <tr>
                                <td>Via e-mail</td>
                                <td>{{ dados['payment_condition'] }}</td>
                                <td>{{ dados['contrato'].start_contract }}</td>
                                <td>{{ dados['contrato'].end_contract }}</td>
                                <td>{{ dados['contrato'].contract_days }}</td>
                                <td class="total-rental"></td>
                                <td class="bold2">FRQ DIA:</td>
                                <td>{{ dados['produtos'].rental_hours }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="form-section">
            <div class="table-products">
                <table>
                    <thead>
                        <tr>
                            <th class="col1">CÓD. PRODUTO</th>
                            <th class="col2">DESCRIÇÃO</th>
                            <th class="col3">VALOR DE NF</th>
                            <th class="col4">VR/DIA LOC</th>
                            <th class="col5">NF REM</th>
                            <th class="col6">DT REM</th>
                            <th class="col7">NF RET</th>
                            <th class="col8">DT RET</th>
                            <th class="col9">OBS</th>
                        </tr>
                    </thead>
                    <tbody id="products-body">
                        {% set products = assets_follow_up[0]['assets'] if assets_follow_up and assets_follow_up[0]['assets'] else [] %}
                        {% for i in range(11) %}
                            <tr>
                                {% set product = products[i] if i < products|length else {} %}
                                <input type="hidden" class="follow-up-id-input" name="follow_up_id" value="{{ product.get('follow_up_id') }}">
                                <input type="hidden" class="contract-id-input" name="contract_id" value="{{ product.get('contract_id', contract_id) }}">
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('asset_cod', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('description', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('value_nf', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('vr_day_loc', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('nf_rem', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('dt_rem', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('nf_ret', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('dt_ret', '') }}</div></td>
                                <td><div contenteditable="true" class="editable-cell">{{ product.get('obs', '') }}</div></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="titulo-memoria">MEMÓRIA DE CÁLCULO</div>
        <div class="alerta">
            Atenção: No encerramento os custos com TRANSPORTE, SUBLOCAÇÃO, SEGURO, ETC devem ser mencionados no relatório final;
        </div>
        <div class="form-section">
            <div class="table-box">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2">Orçado</th>
                        </tr>
                    </thead>
                    <tbody id="budget_body">
                        <tr><td>Máquinas</td><td class="value-machines"></td></tr>
                        <tr><td>Cabos / Acessórios</td><td class="value-accessories"></td></tr>
                        <tr><td>Operação</td><td class="operation"></td></tr>
                        <tr><td>Frete Geraforça</td><td class="freight-gf"></td></tr>
                        <tr><td>Frete Terceiro</td><td class="freight-third"></td></tr>
                        <tr><td>Diesel</td><td class="diesel"></td></tr>
                        <tr><td>Hospedagem / Alimentação</td><td class="hosp-alim"></td></tr>
                        <tr><td class="value-budget"></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-box">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2">Despesas</th>
                        </tr>
                    </thead>
                    <tbody id="expenses_body">
                        {% for custo in custos_parada_data %}
                            <tr><td>Sublocação de Máquinas</td><td class="sub-machines">{{ custo['sub'].sub_total_value_machines }}</td></tr>
                            <tr><td>Sublocação Cabos / Acesssórios</td><td class="sub-accessories">{{ custo['sub'].sub_total_value_accessories }}</td></tr>
                            <tr><td>Op/Assistencia (H/H e Deslocamento)</td><td class="operation-assist"></td></tr>
                            <tr><td>Frete Geraforça</td><td class="freight-gf-expense">{{ custo['freight'].freight_total_value }}</td></tr>
                            <tr><td>Frete Terceiro</td><td class="freight-third-expense">{{ custo['freight'].freight_total_value_third }}</td></tr>
                            <tr><td>Diesel Consumido</td><td class="diesel-expense"></td></tr>
                            <tr><td>Hospedagem / Alimentação</td><td class="hosp-alim-expense">{{ custo['op_cost'].op_cost_total_value_food_stay }}</td></tr>
                            <tr><td class="value-expense"></td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="form-section">
            <div class="form-grid">
                <div>
                    <label for="total_billed">TOTAL FATURADO</label>
                    <input type="text" name="total_billed" id="total_billed" readonly>
                </div>
                <div>
                    <label for="billed_expenses">Total Faturado - Despesas</label>
                    <input type="text" name="billed_expenses" id="billed_expenses" readonly>
                </div>
                <div>
                    <label for="diesel_return">Retorno de Diesel</label>
                    <input type="text" name="diesel_return" id="diesel_return" readonly>
                </div>
                <div>
                    <label for="refund">Ressarcimento</label>
                    <input type="text" name="refund" id="refund" readonly>
                </div>
                <div>
                    <label for="extra_hours">Hora Excedente</label>
                    <input type="text" name="extra_hours" id="extra_hours" readonly>
                </div>
                <div>
                    <label for="general_balance">Saldo Geral</label>
                    <input type="text" name="general_balance" id="general_balance" readonly>
                </div>
                <div>
                    <label for="margin">Margem</label>
                    <input type="text" name="margin" id="margin" readonly>
                </div>
            </div>
        </div>
        <div class="form-section">
            <div class="table-products2">
                <table>
                    <thead>
                        <tr>
                            <th colspan="3" class="c1"></th>
                            <th class="c2"></th>
                            <th class="c3"></th>
                            <th colspan="3" class="c4">MEDIÇÃO DE OLEO DIESEL (LTS)</th>
                            <th class="c5"></th>
                            <th class="c6"></th>
                            <th colspan="7" class="c7">MEDIÇÃO DE HORAS EXCEDENTES</th>
                            <th class="c8"></th>
                            <th class="c9"></th>
                            <th class="c10"></th>
                            <th class="c11"></th>
                            <th class="c12"></th>
                            <th class="c13"></th>
                        </tr>
                        <tr>
                            <th class="bold2">GMG</th>
                            <th class="bold2">Dt. Inicial</th>
                            <th class="bold2">Dt. Final</th>
                            <th class="bold2">Diesel Env</th>
                            <th class="bold2">Total Utilizado</th>
                            <th class="bold2">Diesel Dev</th>
                            <th class="bold2">Franquia</th>
                            <th class="bold2">Hor. Inicial</th>
                            <th class="bold2">Hor. Final</th>
                            <th class="bold2">Total Hrs</th>
                            <th class="bold2">H. Exc.</th>
                            <th class="bold2">Vl Hr. Exc</th>
                            <th class="bold2">Total</th>
                        </tr>
                    </thead>
                    <tbody id="products2_body">
                        {% set products = assets_follow_up[0]['assets'] if assets_follow_up and assets_follow_up[0]['assets'] else [] %}
                        {% for i in range(5) %}
                        <tr>
                            {% set product = products[i] if i < products|length else {} %}
                            <input type="hidden" class="follow-up-id-input" name="follow_up_id" value="{{ product.get('follow_up_id') }}">
                            <input type="hidden" class="contract-id-input" name="contract_id" value="{{ product.get('contract_id', contract_id) }}">

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </form>
</body>
</html>
